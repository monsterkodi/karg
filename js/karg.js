// koffee 0.56.0

/*
000   000   0000000   00000000    0000000 
000  000   000   000  000   000  000      
0000000    000000000  0000000    000  0000
000  000   000   000  000   000  000   000
000   000  000   000  000   000   0000000
 */
var clone, error, expand, isEmpty, isString, padEnd, parse, size, values,
    indexOf = [].indexOf;

isEmpty = require('lodash.isempty');

padEnd = require('lodash.padend');

size = require('lodash.size');

values = require('lodash.values');

isString = require('lodash.isstring');

clone = require('lodash.clone');

require('klor').kolor.globalize();


/*
00000000  000   000  00000000    0000000   000   000  0000000  
000        000 000   000   000  000   000  0000  000  000   000
0000000     00000    00000000   000000000  000 0 000  000   000
000        000 000   000        000   000  000  0000  000   000
00000000  000   000  000        000   000  000   000  0000000
 */

expand = function(l) {
    var a, j, len, match;
    for (j = 0, len = l.length; j < len; j++) {
        a = l[j];
        if (match = /^\-(\w\w+)$/.exec(a)) {
            a = match[1].split('').map(function(i) {
                return '-' + i;
            });
            a.unshift(l.indexOf(match.input), 1);
            l.splice.apply(l, a);
            return expand(l);
        }
    }
    return l;
};


/*
00000000  00000000   00000000    0000000   00000000 
000       000   000  000   000  000   000  000   000
0000000   0000000    0000000    000   000  0000000  
000       000   000  000   000  000   000  000   000
00000000  000   000  000   000   0000000   000   000
 */

error = function(msg) {
    var s;
    s = dim(red("[" + bold("ERROR") + "] "));
    s += red(msg.trim().split('\n').join("\n        "));
    return console.log(s);
};


/*
00000000    0000000   00000000    0000000  00000000
000   000  000   000  000   000  000       000     
00000000   000000000  0000000    0000000   0000000 
000        000   000  000   000       000  000     
000        000   000  000   000  0000000   00000000
 */

parse = function(config, options) {
    var addIgnored, addParam, addParamOrIgnore, arg, argv, df, expandedArgs, help, helpText, k, lng, maxArgLength, maxHelpLength, name, noon, optionsText, param, paramList, ref, ref1, result, short, sht, v, version;
    if (options == null) {
        options = {};
    }
    if (isString(config)) {
        noon = require('noon');
        config = noon.parse(config);
    } else {
        config = clone(config);
    }
    name = Object.keys(config)[0];
    result = {};
    help = {};
    short = {};
    param = '';
    paramList = false;
    ref = config[name];
    for (k in ref) {
        v = ref[k];
        if (0 <= k.indexOf(' ')) {
            console.error("wrong karg setup: " + (bold("keys can't contain spaces!")) + "\nbroken key: " + (bold(yellow(k))));
            process.exit(1);
        }
        if (v['='] != null) {
            result[k] = v['='];
        }
        sht = (v['-'] != null) && v['-'] || k[0];
        if (Array.isArray(v)) {
            if (indexOf.call(v, '*') >= 0) {
                param = k;
            } else if (indexOf.call(v, '**') >= 0) {
                param = k;
                paramList = true;
                result[param] = [];
            } else {
                short[sht] = k;
            }
        } else {
            if (indexOf.call(Object.keys(v), '*') >= 0) {
                param = k;
            } else if (indexOf.call(Object.keys(v), '**') >= 0) {
                param = k;
                paramList = true;
                result[param] = [];
            } else {
                short[sht] = k;
                help[sht] = v['?'];
            }
        }
    }

    /*
     0000000   00000000   000000000  000   0000000   000   000   0000000
    000   000  000   000     000     000  000   000  0000  000  000     
    000   000  00000000      000     000  000   000  000 0 000  0000000 
    000   000  000           000     000  000   000  000  0000       000
     0000000   000           000     000   0000000   000   000  0000000
     */
    optionsText = "";
    maxArgLength = 0;
    maxHelpLength = 0;
    for (sht in short) {
        lng = short[sht];
        if (help[sht] != null) {
            maxArgLength = Math.max(maxArgLength, sht.length + lng.length);
            maxHelpLength = Math.max(maxHelpLength, strip(help[sht]).length);
        }
    }
    for (sht in short) {
        lng = short[sht];
        if (help[sht] != null) {
            df = (function() {
                switch (result[lng]) {
                    case false:
                        return red(dim('✘'));
                    case true:
                        return green(bold('✔'));
                    default:
                        return result[lng];
                }
            })();
            optionsText += '\n';
            optionsText += "    " + (gray('-')) + sht + (gray(', --')) + lng;
            optionsText += gray(bold("    " + (padEnd('', Math.max(0, maxArgLength - sht.length - lng.length))) + " " + help[sht]));
            if (df != null) {
                optionsText += magenta("    " + (padEnd('', Math.max(0, maxHelpLength - strip(help[sht]).length))) + " " + df);
            }
        }
    }

    /*
    000   000  00000000  000      00000000 
    000   000  000       000      000   000
    000000000  0000000   000      00000000 
    000   000  000       000      000      
    000   000  00000000  0000000  000
     */
    helpText = "\n" + (gray('usage:')) + "  " + (bold(name)) + " ";
    if (1 < size(short)) {
        helpText += "" + (gray('[')) + (bold(gray('options'))) + (gray(']')) + " ";
    }
    helpText += "" + (gray('[')) + (bold(yellow(param))) + (paramList && gray(' ... ]') || gray(']'));
    helpText += '\n';
    if ((ref1 = config[name][param]) != null ? ref1['?'] : void 0) {
        helpText += yellow(bold("\n" + (padEnd('        ' + param, maxArgLength + 9)) + " " + (gray(config[name][param]['?']))));
        if ((config[name][param]['='] != null) && !paramList) {
            helpText += magenta("  " + (padEnd('', Math.max(0, maxHelpLength - strip(config[name][param]['?']).length))) + " " + config[name][param]['=']);
        }
        helpText += '\n';
    }
    if (optionsText.length) {
        helpText += gray("\noptions:\n");
        helpText += optionsText;
        helpText += '\n\n';
    }
    if (short['h'] != null) {
        short['h'];
    } else {
        short['h'] = 'help';
    }
    if (config.version != null) {
        version = config.version;
        delete config.version;
        if (short['V'] != null) {
            short['V'];
        } else {
            short['V'] = 'version';
        }
    }
    delete config[name];
    if (!isEmpty(config)) {
        helpText += noon.stringify(config, {
            maxalign: 16,
            colors: {
                key: gray,
                string: white
            }
        });
        helpText += '\n';
    }

    /*
    00000000   00000000   0000000  000   000  000      000000000
    000   000  000       000       000   000  000         000   
    0000000    0000000   0000000   000   000  000         000   
    000   000  000            000  000   000  000         000   
    000   000  00000000  0000000    0000000   0000000     000
     */
    if (options.ignoreArgs != null) {
        options.ignoreArgs;
    } else {
        options.ignoreArgs = 2;
    }
    if (options.argv) {
        argv = options.argv;
    } else {
        argv = process.argv.slice(options.ignoreArgs);
    }
    expandedArgs = expand(argv);
    addParam = function(arg) {
        if (paramList) {
            return result[param].push(arg);
        } else {
            return result[param] = arg;
        }
    };
    addIgnored = function(arg) {
        if (!result['__ignored']) {
            result['__ignored'] = [];
        }
        return result['__ignored'].push(arg);
    };
    addParamOrIgnore = function(arg) {
        if (param) {
            return addParam(arg);
        } else {
            return addIgnored(arg);
        }
    };
    while (arg = expandedArgs.shift()) {
        if (arg.substr(0, 2) === '--') {
            arg = arg.substr(2);
        } else if (arg[0] === '-') {
            if (!short[arg.substr(1)]) {
                addIgnored(arg);
                continue;
            }
            arg = short[arg.substr(1)];
        } else {
            addParamOrIgnore(arg);
            continue;
        }
        if (arg === 'help') {
            if (options.returnLog) {
                return helpText;
            }
            console.log(helpText);
            if (options.dontExit) {
                return;
            }
            process.exit();
        } else if (arg === 'version' && (version != null)) {
            if (options.returnLog) {
                return version;
            }
            console.log(version);
            if (options.dontExit) {
                return;
            }
            process.exit();
        }
        if (result[arg] === false || result[arg] === true) {
            result[arg] = !result[arg];
        } else if (!isNaN(parseFloat(result[arg]))) {
            result[arg] = parseFloat(expandedArgs.shift());
        } else if (indexOf.call(values(short), arg) >= 0) {
            result[arg] = expandedArgs.shift();
        } else {
            addParamOrIgnore(arg);
        }
    }
    return result;
};

module.exports = parse;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2FyZy5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsb0VBQUE7SUFBQTs7QUFRQSxPQUFBLEdBQVcsT0FBQSxDQUFRLGdCQUFSOztBQUNYLE1BQUEsR0FBVyxPQUFBLENBQVEsZUFBUjs7QUFDWCxJQUFBLEdBQVcsT0FBQSxDQUFRLGFBQVI7O0FBQ1gsTUFBQSxHQUFXLE9BQUEsQ0FBUSxlQUFSOztBQUNYLFFBQUEsR0FBVyxPQUFBLENBQVEsaUJBQVI7O0FBQ1gsS0FBQSxHQUFXLE9BQUEsQ0FBUSxjQUFSOztBQUNYLE9BQUEsQ0FBUSxNQUFSLENBQWUsQ0FBQyxLQUFLLENBQUMsU0FBdEIsQ0FBQTs7O0FBRUE7Ozs7Ozs7O0FBUUEsTUFBQSxHQUFTLFNBQUMsQ0FBRDtBQUNMLFFBQUE7QUFBQSxTQUFBLG1DQUFBOztRQUNJLElBQUcsS0FBQSxHQUFRLGFBQWEsQ0FBQyxJQUFkLENBQW1CLENBQW5CLENBQVg7WUFDSSxDQUFBLEdBQUksS0FBTSxDQUFBLENBQUEsQ0FBRSxDQUFDLEtBQVQsQ0FBZSxFQUFmLENBQWtCLENBQUMsR0FBbkIsQ0FBdUIsU0FBQyxDQUFEO3VCQUFPLEdBQUEsR0FBSTtZQUFYLENBQXZCO1lBQ0osQ0FBQyxDQUFDLE9BQUYsQ0FBVSxDQUFDLENBQUMsT0FBRixDQUFVLEtBQUssQ0FBQyxLQUFoQixDQUFWLEVBQWtDLENBQWxDO1lBQ0EsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFULENBQWUsQ0FBZixFQUFrQixDQUFsQjtBQUNBLG1CQUFPLE1BQUEsQ0FBTyxDQUFQLEVBSlg7O0FBREo7V0FNQTtBQVBLOzs7QUFTVDs7Ozs7Ozs7QUFRQSxLQUFBLEdBQVEsU0FBQyxHQUFEO0FBQ0osUUFBQTtJQUFBLENBQUEsR0FBSSxHQUFBLENBQUksR0FBQSxDQUFJLEdBQUEsR0FBTSxJQUFBLENBQUssT0FBTCxDQUFOLEdBQXNCLElBQTFCLENBQUo7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LE9BQU8sQ0FBQyxJQUFSLENBQUEsRUFKQzs7UUFNTCxJQUFHLE1BQU8sQ0FBQSxHQUFBLENBQVAsS0FBZSxLQUFmLElBQXdCLE1BQU8sQ0FBQSxHQUFBLENBQVAsS0FBZSxJQUExQztZQUNJLE1BQU8sQ0FBQSxHQUFBLENBQVAsR0FBYyxDQUFJLE1BQU8sQ0FBQSxHQUFBLEVBRDdCO1NBQUEsTUFFSyxJQUFHLENBQUksS0FBQSxDQUFNLFVBQUEsQ0FBVyxNQUFPLENBQUEsR0FBQSxDQUFsQixDQUFOLENBQVA7WUFDRCxNQUFPLENBQUEsR0FBQSxDQUFQLEdBQWMsVUFBQSxDQUFXLFlBQVksQ0FBQyxLQUFiLENBQUEsQ0FBWCxFQURiO1NBQUEsTUFFQSxJQUFHLGFBQU8sTUFBQSxDQUFPLEtBQVAsQ0FBUCxFQUFBLEdBQUEsTUFBSDtZQUNELE1BQU8sQ0FBQSxHQUFBLENBQVAsR0FBYyxZQUFZLENBQUMsS0FBYixDQUFBLEVBRGI7U0FBQSxNQUFBO1lBR0QsZ0JBQUEsQ0FBaUIsR0FBakIsRUFIQzs7SUE1QlQ7V0FnQ0E7QUFuTEk7O0FBcUxSLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgMDAwMDAwMCBcbjAwMCAgMDAwICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIFxuMDAwMDAwMCAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwICAwMDAwXG4wMDAgIDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcbjAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwIFxuIyMjXG5cbmlzRW1wdHkgID0gcmVxdWlyZSAnbG9kYXNoLmlzZW1wdHknXG5wYWRFbmQgICA9IHJlcXVpcmUgJ2xvZGFzaC5wYWRlbmQnXG5zaXplICAgICA9IHJlcXVpcmUgJ2xvZGFzaC5zaXplJ1xudmFsdWVzICAgPSByZXF1aXJlICdsb2Rhc2gudmFsdWVzJ1xuaXNTdHJpbmcgPSByZXF1aXJlICdsb2Rhc2guaXNzdHJpbmcnXG5jbG9uZSAgICA9IHJlcXVpcmUgJ2xvZGFzaC5jbG9uZSdcbnJlcXVpcmUoJ2tsb3InKS5rb2xvci5nbG9iYWxpemUoKVxuICAgIFxuIyMjXG4wMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICBcbjAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgIDAwMFxuMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAwIDAwMCAgMDAwICAgMDAwXG4wMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDBcbjAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuIyMjXG5cbmV4cGFuZCA9IChsKSAtPlxuICAgIGZvciBhIGluIGwgXG4gICAgICAgIGlmIG1hdGNoID0gL15cXC0oXFx3XFx3KykkLy5leGVjIGFcbiAgICAgICAgICAgIGEgPSBtYXRjaFsxXS5zcGxpdCgnJykubWFwIChpKSAtPiAnLScraVxuICAgICAgICAgICAgYS51bnNoaWZ0IGwuaW5kZXhPZihtYXRjaC5pbnB1dCksIDFcbiAgICAgICAgICAgIGwuc3BsaWNlLmFwcGx5IGwsIGFcbiAgICAgICAgICAgIHJldHVybiBleHBhbmQgbFxuICAgIGxcblxuIyMjXG4wMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgXG4wMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgXG4wMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4jIyNcblxuZXJyb3IgPSAobXNnKSAtPlxuICAgIHMgPSBkaW0gcmVkIFwiW1wiICsgYm9sZChcIkVSUk9SXCIpICsgXCJdIFwiXG4gICAgcyArPSByZWQgbXNnLnRyaW0oKS5zcGxpdCgnXFxuJykuam9pbihcIlxcbiAgICAgICAgXCIpXG4gICAgbG9nIHNcblxuIyMjXG4wMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDBcbjAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgIFxuMDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgXG4wMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICBcbjAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMFxuIyMjXG5cbiMgb3B0aW9uczogXG4jICAgICBpZ25vcmVBcmdzOiAgbnVtYmVyIG9mIGxlYWRpbmcgcHJvY2Vzcy5hcmd2IGl0ZW1zIHRvIGlnbm9yZSAoZGVmYXVsdD0yKVxuIyAgICAgYXJndjogICAgICAgIGxpc3Qgb2Ygc3RyaW5nIGFyZ3VtZW50cyB0byB1c2UgaW5zdGVhZCBvZiBwcm9jZXNzLmFyZ3ZcbiMgICAgIGRvbnRFeGl0OiAgICBkb24ndCBleGl0IHByb2Nlc3Mgb24gLVYvLS12ZXJzaW9uIG9yIC1oLy0taGVscCAgKHJldHVybnMgdW5kZWZpbmVkIGluc3RlYWQpXG4jICAgICByZXR1cm5Mb2c6ICAgaGVscC92ZXJzaW9uIG91dHB1dCBpcyByZXR1cm5lZCBpbnN0ZWFkIG9mIGxvZ2dlZCAoaW1wbGllcyBkb250RXhpdClcblxucGFyc2UgPSAoY29uZmlnLCBvcHRpb25zPXt9KSAtPlxuICAgIFxuICAgIGlmIGlzU3RyaW5nIGNvbmZpZ1xuICAgICAgICBub29uICAgPSByZXF1aXJlICdub29uJ1xuICAgICAgICBjb25maWcgPSBub29uLnBhcnNlIGNvbmZpZ1xuICAgIGVsc2VcbiAgICAgICAgY29uZmlnID0gY2xvbmUgY29uZmlnXG4gICAgICAgICAgICBcbiAgICBuYW1lICAgPSBPYmplY3Qua2V5cyhjb25maWcpWzBdICMgdGhlIGFwcGxpY2F0aW9uL3NjcmlwdCBuYW1lXG4gICAgcmVzdWx0ID0ge30gIyB0aGUgb2JqZWN0IGNyZWF0ZWQgZnJvbSB0aGUgcHJvdmlkZWQgYXJndW1lbnRzIGFuZCB0aGUgY29uZmlndXJhdGlvblxuICAgIGhlbHAgICA9IHt9ICMgbWFwcyBzaG9ydGN1dCBrZXlzIHRvIGhlbHAgdGV4dHNcbiAgICBzaG9ydCAgPSB7fSAjIG1hcHMgc2hvcnRjdXQga2V5cyB0byBsb25nIGtleSBuYW1lc1xuICAgIHBhcmFtICA9ICcnICMgbmFtZSBvZiBub24tb3B0aW9uIHBhcmFtZXRlcnNcbiAgICBwYXJhbUxpc3QgPSBmYWxzZVxuICAgIFxuICAgIGZvciBrLHYgb2YgY29uZmlnW25hbWVdXG4gICAgICAgIFxuICAgICAgICBpZiAwIDw9IGsuaW5kZXhPZiAnICdcbiAgICAgICAgICAgIGVycm9yIFwiXCJcIlxuICAgICAgICAgICAgd3Jvbmcga2FyZyBzZXR1cDogI3tib2xkIFwia2V5cyBjYW4ndCBjb250YWluIHNwYWNlcyFcIn1cbiAgICAgICAgICAgIGJyb2tlbiBrZXk6ICN7Ym9sZCB5ZWxsb3cga31cbiAgICAgICAgICAgIFwiXCJcIlxuICAgICAgICAgICAgcHJvY2Vzcy5leGl0IDFcbiAgICAgICAgXG4gICAgICAgIGlmIHZbJz0nXT8gdGhlbiByZXN1bHRba10gPSB2Wyc9J11cbiAgICAgICAgXG4gICAgICAgIHNodCA9IHZbJy0nXT8gYW5kIHZbJy0nXSBvciBrWzBdXG4gICAgICAgIFxuICAgICAgICBpZiBBcnJheS5pc0FycmF5IHZcbiAgICAgICAgICAgIGlmICcqJyBpbiB2XG4gICAgICAgICAgICAgICAgcGFyYW0gPSBrXG4gICAgICAgICAgICBlbHNlIGlmICcqKicgaW4gdlxuICAgICAgICAgICAgICAgIHBhcmFtID0ga1xuICAgICAgICAgICAgICAgIHBhcmFtTGlzdCA9IHRydWVcbiAgICAgICAgICAgICAgICByZXN1bHRbcGFyYW1dID0gW11cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzaG9ydFtzaHRdID0ga1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpZiAnKicgaW4gT2JqZWN0LmtleXMgdlxuICAgICAgICAgICAgICAgIHBhcmFtID0ga1xuICAgICAgICAgICAgZWxzZSBpZiAnKionIGluIE9iamVjdC5rZXlzIHZcbiAgICAgICAgICAgICAgICBwYXJhbSA9IGtcbiAgICAgICAgICAgICAgICBwYXJhbUxpc3QgPSB0cnVlXG4gICAgICAgICAgICAgICAgcmVzdWx0W3BhcmFtXSA9IFtdXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2hvcnRbc2h0XSA9IGtcbiAgICAgICAgICAgICAgICBoZWxwW3NodF0gPSB2Wyc/J11cblxuICAgICMjI1xuICAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwXG4gICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICBcbiAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwIFxuICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgICAgICAgMDAwXG4gICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCBcbiAgICAjIyNcbiAgICBcbiAgICBvcHRpb25zVGV4dCA9IFwiXCJcbiAgICAgICAgXG4gICAgbWF4QXJnTGVuZ3RoID0gMFxuICAgIG1heEhlbHBMZW5ndGggPSAwXG4gICAgZm9yIHNodCxsbmcgb2Ygc2hvcnRcbiAgICAgICAgaWYgaGVscFtzaHRdP1xuICAgICAgICAgICAgbWF4QXJnTGVuZ3RoICA9IE1hdGgubWF4KG1heEFyZ0xlbmd0aCwgc2h0Lmxlbmd0aCtsbmcubGVuZ3RoKVxuICAgICAgICAgICAgbWF4SGVscExlbmd0aCA9IE1hdGgubWF4KG1heEhlbHBMZW5ndGgsIHN0cmlwKGhlbHBbc2h0XSkubGVuZ3RoKVxuICAgICAgICAgICAgXG4gICAgZm9yIHNodCxsbmcgb2Ygc2hvcnRcbiAgICAgICAgaWYgaGVscFtzaHRdP1xuICAgICAgICAgICAgZGYgPSBzd2l0Y2ggcmVzdWx0W2xuZ11cbiAgICAgICAgICAgICAgICB3aGVuIGZhbHNlIHRoZW4gcmVkIGRpbSAn4pyYJ1xuICAgICAgICAgICAgICAgIHdoZW4gdHJ1ZSAgdGhlbiBncmVlbiBib2xkICfinJQnXG4gICAgICAgICAgICAgICAgZWxzZSByZXN1bHRbbG5nXVxuICAgICAgICAgICAgb3B0aW9uc1RleHQgKz0gJ1xcbidcbiAgICAgICAgICAgIG9wdGlvbnNUZXh0ICs9IFwiICAgICN7Z3JheSAnLSd9I3tzaHR9I3tncmF5ICcsIC0tJ30je2xuZ31cIlxuICAgICAgICAgICAgb3B0aW9uc1RleHQgKz0gZ3JheSBib2xkIFwiICAgICN7cGFkRW5kICcnLCBNYXRoLm1heCgwLG1heEFyZ0xlbmd0aC1zaHQubGVuZ3RoLWxuZy5sZW5ndGgpfSAje2hlbHBbc2h0XX1cIlxuICAgICAgICAgICAgb3B0aW9uc1RleHQgKz0gbWFnZW50YSBcIiAgICAje3BhZEVuZCAnJywgTWF0aC5tYXgoMCxtYXhIZWxwTGVuZ3RoLXN0cmlwKGhlbHBbc2h0XSkubGVuZ3RoKX0gI3tkZn1cIiBpZiBkZj9cblxuICAgICMjI1xuICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMDAwMDAwIFxuICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMFxuICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAwIFxuICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgIFxuICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMCAgICAgIFxuICAgICMjI1xuICAgIFxuICAgIGhlbHBUZXh0ICA9IFwiXFxuI3tncmF5ICd1c2FnZTonfSAgI3tib2xkIG5hbWV9IFwiXG4gICAgaGVscFRleHQgKz0gXCIje2dyYXkgJ1snfSN7Ym9sZCBncmF5ICdvcHRpb25zJ30je2dyYXkgJ10nfSBcIiBpZiAxIDwgc2l6ZSBzaG9ydFxuICAgIGhlbHBUZXh0ICs9IFwiI3tncmF5ICdbJ30je2JvbGQgeWVsbG93IHBhcmFtfSN7cGFyYW1MaXN0IGFuZCBncmF5KCcgLi4uIF0nKSBvciBncmF5KCddJyl9XCJcbiAgICBoZWxwVGV4dCArPSAnXFxuJ1xuICAgIGlmIGNvbmZpZ1tuYW1lXVtwYXJhbV0/Wyc/J11cbiAgICAgICAgaGVscFRleHQgKz0geWVsbG93IGJvbGQgXCJcXG4je3BhZEVuZCAnICAgICAgICAnK3BhcmFtLCBtYXhBcmdMZW5ndGgrOX0gI3tncmF5IGNvbmZpZ1tuYW1lXVtwYXJhbV1bJz8nXX1cIlxuICAgICAgICBoZWxwVGV4dCArPSBtYWdlbnRhKFwiICAje3BhZEVuZCAnJywgTWF0aC5tYXgoMCxtYXhIZWxwTGVuZ3RoLXN0cmlwKGNvbmZpZ1tuYW1lXVtwYXJhbV1bJz8nXSkubGVuZ3RoKX0gI3tjb25maWdbbmFtZV1bcGFyYW1dWyc9J119XCIpIGlmIGNvbmZpZ1tuYW1lXVtwYXJhbV1bJz0nXT8gYW5kIG5vdCBwYXJhbUxpc3RcbiAgICAgICAgaGVscFRleHQgKz0gJ1xcbidcbiAgICAgICAgICAgIFxuICAgIGlmIG9wdGlvbnNUZXh0Lmxlbmd0aFxuICAgICAgICBoZWxwVGV4dCArPSBncmF5IFwiXFxub3B0aW9uczpcXG5cIlxuICAgICAgICBoZWxwVGV4dCArPSBvcHRpb25zVGV4dFxuICAgICAgICBoZWxwVGV4dCArPSAnXFxuXFxuJ1xuICAgIFxuICAgIHNob3J0WydoJ10gPz0gJ2hlbHAnXG4gICAgXG4gICAgaWYgY29uZmlnLnZlcnNpb24/XG4gICAgICAgIHZlcnNpb24gPSBjb25maWcudmVyc2lvblxuICAgICAgICBkZWxldGUgY29uZmlnLnZlcnNpb25cbiAgICAgICAgc2hvcnRbJ1YnXSA/PSAndmVyc2lvbidcbiAgICAgICAgXG4gICAgZGVsZXRlIGNvbmZpZ1tuYW1lXVxuICAgIGlmIG5vdCBpc0VtcHR5IGNvbmZpZ1xuICAgICAgICBoZWxwVGV4dCArPSBub29uLnN0cmluZ2lmeSBjb25maWcsIFxuICAgICAgICAgICAgbWF4YWxpZ246IDE2XG4gICAgICAgICAgICBjb2xvcnM6IFxuICAgICAgICAgICAgICAgIGtleTogICAgIGdyYXlcbiAgICAgICAgICAgICAgICBzdHJpbmc6ICB3aGl0ZVxuICAgICAgICBoZWxwVGV4dCArPSAnXFxuJ1xuICAgICAgICBcbiAgICAjIyNcbiAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAwMDAwMDAwMDBcbiAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgICAwMDAgICBcbiAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgICAwMDAgICBcbiAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAwMDAgICBcbiAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAwMDAgICBcbiAgICAjIyNcblxuICAgIG9wdGlvbnMuaWdub3JlQXJncyA/PSAyXG4gICAgXG4gICAgaWYgb3B0aW9ucy5hcmd2XG4gICAgICAgIGFyZ3YgPSBvcHRpb25zLmFyZ3ZcbiAgICBlbHNlXG4gICAgICAgIGFyZ3YgPSBwcm9jZXNzLmFyZ3Yuc2xpY2Ugb3B0aW9ucy5pZ25vcmVBcmdzXG4gICAgICAgIFxuICAgIGV4cGFuZGVkQXJncyA9IGV4cGFuZCBhcmd2XG5cbiAgICBhZGRQYXJhbSA9IChhcmcpIC0+XG4gICAgICAgIGlmIHBhcmFtTGlzdFxuICAgICAgICAgICAgcmVzdWx0W3BhcmFtXS5wdXNoIGFyZ1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXN1bHRbcGFyYW1dID0gYXJnXG4gICAgICAgICAgICBcbiAgICBhZGRJZ25vcmVkID0gKGFyZykgLT5cbiAgICAgICAgaWYgbm90IHJlc3VsdFsnX19pZ25vcmVkJ10gdGhlbiByZXN1bHRbJ19faWdub3JlZCddID0gW11cbiAgICAgICAgcmVzdWx0WydfX2lnbm9yZWQnXS5wdXNoIGFyZ1xuICAgICAgICBcbiAgICBhZGRQYXJhbU9ySWdub3JlID0gKGFyZykgLT5cbiAgICAgICAgaWYgcGFyYW1cbiAgICAgICAgICAgIGFkZFBhcmFtIGFyZ1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBhZGRJZ25vcmVkIGFyZ1xuICAgIFxuICAgIHdoaWxlIGFyZyA9IGV4cGFuZGVkQXJncy5zaGlmdCgpXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgYXJnLnN1YnN0cigwLDIpID09ICctLSdcbiAgICAgICAgICAgIGFyZyA9IGFyZy5zdWJzdHIgMlxuICAgICAgICBlbHNlIGlmIGFyZ1swXSA9PSAnLSdcbiAgICAgICAgICAgIGlmIG5vdCBzaG9ydFthcmcuc3Vic3RyIDFdXG4gICAgICAgICAgICAgICAgYWRkSWdub3JlZCBhcmdcbiAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgYXJnID0gc2hvcnRbYXJnLnN1YnN0ciAxXVxuICAgICAgICBlbHNlIFxuICAgICAgICAgICAgYWRkUGFyYW1Pcklnbm9yZSBhcmdcbiAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgYXJnID09ICdoZWxwJ1xuICAgICAgICAgICAgaWYgb3B0aW9ucy5yZXR1cm5Mb2cgdGhlbiByZXR1cm4gaGVscFRleHRcbiAgICAgICAgICAgIGxvZyBoZWxwVGV4dFxuICAgICAgICAgICAgcmV0dXJuIGlmIG9wdGlvbnMuZG9udEV4aXRcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgpXG4gICAgICAgIGVsc2UgaWYgYXJnID09ICd2ZXJzaW9uJyBhbmQgdmVyc2lvbj9cbiAgICAgICAgICAgIGlmIG9wdGlvbnMucmV0dXJuTG9nIHRoZW4gcmV0dXJuIHZlcnNpb25cbiAgICAgICAgICAgIGxvZyB2ZXJzaW9uXG4gICAgICAgICAgICByZXR1cm4gaWYgb3B0aW9ucy5kb250RXhpdFxuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KClcbiAgICAgICAgICAgIFxuICAgICAgICBpZiByZXN1bHRbYXJnXSA9PSBmYWxzZSBvciByZXN1bHRbYXJnXSA9PSB0cnVlXG4gICAgICAgICAgICByZXN1bHRbYXJnXSA9IG5vdCByZXN1bHRbYXJnXVxuICAgICAgICBlbHNlIGlmIG5vdCBpc05hTiBwYXJzZUZsb2F0IHJlc3VsdFthcmddXG4gICAgICAgICAgICByZXN1bHRbYXJnXSA9IHBhcnNlRmxvYXQgZXhwYW5kZWRBcmdzLnNoaWZ0KClcbiAgICAgICAgZWxzZSBpZiBhcmcgaW4gdmFsdWVzIHNob3J0XG4gICAgICAgICAgICByZXN1bHRbYXJnXSA9IGV4cGFuZGVkQXJncy5zaGlmdCgpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGFkZFBhcmFtT3JJZ25vcmUgYXJnXG4gICAgcmVzdWx0XG5cbm1vZHVsZS5leHBvcnRzID0gcGFyc2VcbiJdfQ==
//# sourceURL=../coffee/karg.coffee