// koffee 0.56.0

/*
000   000   0000000   00000000    0000000 
000  000   000   000  000   000  000      
0000000    000000000  0000000    000  0000
000  000   000   000  000   000  000   000
000   000  000   000  000   000   0000000
 */
var clone, error, expand, isEmpty, isString, padEnd, parse, size, values,
    indexOf = [].indexOf;

isEmpty = require('lodash.isempty');

padEnd = require('lodash.padend');

size = require('lodash.size');

values = require('lodash.values');

isString = require('lodash.isstring');

clone = require('lodash.clone');


/*
00000000  000   000  00000000    0000000   000   000  0000000  
000        000 000   000   000  000   000  0000  000  000   000
0000000     00000    00000000   000000000  000 0 000  000   000
000        000 000   000        000   000  000  0000  000   000
00000000  000   000  000        000   000  000   000  0000000
 */

expand = function(l) {
    var a, j, len, match;
    for (j = 0, len = l.length; j < len; j++) {
        a = l[j];
        if (match = /^\-(\w\w+)$/.exec(a)) {
            a = match[1].split('').map(function(i) {
                return '-' + i;
            });
            a.unshift(l.indexOf(match.input), 1);
            l.splice.apply(l, a);
            return expand(l);
        }
    }
    return l;
};


/*
00000000  00000000   00000000    0000000   00000000 
000       000   000  000   000  000   000  000   000
0000000   0000000    0000000    000   000  0000000  
000       000   000  000   000  000   000  000   000
00000000  000   000  000   000   0000000   000   000
 */

error = function(msg) {
    var s;
    s = "[".dim.red + "ERROR".bold.dim.red + "] ".dim.red;
    s += msg.trim().split('\n').join("\n        ").red;
    return console.log(s);
};


/*
00000000    0000000   00000000    0000000  00000000
000   000  000   000  000   000  000       000     
00000000   000000000  0000000    0000000   0000000 
000        000   000  000   000       000  000     
000        000   000  000   000  0000000   00000000
 */

parse = function(config, options) {
    var addIgnored, addParam, addParamOrIgnore, arg, argv, colors, df, expandedArgs, help, helpText, k, lng, maxArgLength, maxHelpLength, name, noon, optionsText, param, paramList, ref, ref1, result, short, sht, v, version;
    if (options == null) {
        options = {};
    }
    if (isString(config)) {
        noon = require('noon');
        config = noon.parse(config);
    } else {
        config = clone(config);
    }
    colors = require('colors');
    name = Object.keys(config)[0];
    result = {};
    help = {};
    short = {};
    param = '';
    paramList = false;
    ref = config[name];
    for (k in ref) {
        v = ref[k];
        if (0 <= k.indexOf(' ')) {
            console.error("wrong karg setup: " + "keys can't contain spaces!".bold + "\nbroken key: " + k.bold.yellow);
            process.exit(1);
        }
        if (v['='] != null) {
            result[k] = v['='];
        }
        sht = (v['-'] != null) && v['-'] || k[0];
        if (Array.isArray(v)) {
            if (indexOf.call(v, '*') >= 0) {
                param = k;
            } else if (indexOf.call(v, '**') >= 0) {
                param = k;
                paramList = true;
                result[param] = [];
            } else {
                short[sht] = k;
            }
        } else {
            if (indexOf.call(Object.keys(v), '*') >= 0) {
                param = k;
            } else if (indexOf.call(Object.keys(v), '**') >= 0) {
                param = k;
                paramList = true;
                result[param] = [];
            } else {
                short[sht] = k;
                help[sht] = v['?'];
            }
        }
    }

    /*
     0000000   00000000   000000000  000   0000000   000   000   0000000
    000   000  000   000     000     000  000   000  0000  000  000     
    000   000  00000000      000     000  000   000  000 0 000  0000000 
    000   000  000           000     000  000   000  000  0000       000
     0000000   000           000     000   0000000   000   000  0000000
     */
    optionsText = "";
    maxArgLength = 0;
    maxHelpLength = 0;
    for (sht in short) {
        lng = short[sht];
        if (help[sht] != null) {
            maxArgLength = Math.max(maxArgLength, sht.length + lng.length);
            maxHelpLength = Math.max(maxHelpLength, colors.strip(help[sht]).length);
        }
    }
    for (sht in short) {
        lng = short[sht];
        if (help[sht] != null) {
            df = (function() {
                switch (result[lng]) {
                    case false:
                        return '✘'.red.dim;
                    case true:
                        return '✔'.green.bold;
                    default:
                        return result[lng];
                }
            })();
            optionsText += '\n';
            optionsText += "    " + '-'.gray + sht + ', --'.gray + lng;
            optionsText += ("    " + (padEnd('', Math.max(0, maxArgLength - sht.length - lng.length))) + " " + help[sht]).gray.bold;
            if (df != null) {
                optionsText += ("    " + (padEnd('', Math.max(0, maxHelpLength - colors.strip(help[sht]).length))) + " " + df).magenta;
            }
        }
    }

    /*
    000   000  00000000  000      00000000 
    000   000  000       000      000   000
    000000000  0000000   000      00000000 
    000   000  000       000      000      
    000   000  00000000  0000000  000
     */
    helpText = "\n" + 'usage:'.gray + "  " + name.bold + " ";
    if (1 < size(short)) {
        helpText += "" + '['.gray + 'options'.bold.gray + ']'.gray + " ";
    }
    helpText += "" + '['.gray + param.bold.yellow + (paramList && ' ... ]'.gray || ']'.gray);
    helpText += '\n';
    if ((ref1 = config[name][param]) != null ? ref1['?'] : void 0) {
        helpText += ("\n" + (padEnd('        ' + param, maxArgLength + 9)) + " " + config[name][param]['?'].gray).yellow.bold;
        if ((config[name][param]['='] != null) && !paramList) {
            helpText += ("  " + (padEnd('', Math.max(0, maxHelpLength - colors.strip(config[name][param]['?']).length))) + " " + config[name][param]['=']).magenta;
        }
        helpText += '\n';
    }
    if (optionsText.length) {
        helpText += "\noptions:\n".gray;
        helpText += optionsText;
        helpText += '\n\n';
    }
    if (short['h'] != null) {
        short['h'];
    } else {
        short['h'] = 'help';
    }
    if (config.version != null) {
        version = config.version;
        delete config.version;
        if (short['V'] != null) {
            short['V'];
        } else {
            short['V'] = 'version';
        }
    }
    colors = require('colors');
    delete config[name];
    if (!isEmpty(config)) {
        helpText += noon.stringify(config, {
            maxalign: 16,
            colors: {
                key: colors.gray,
                string: colors.white
            }
        });
        helpText += '\n';
    }

    /*
    00000000   00000000   0000000  000   000  000      000000000
    000   000  000       000       000   000  000         000   
    0000000    0000000   0000000   000   000  000         000   
    000   000  000            000  000   000  000         000   
    000   000  00000000  0000000    0000000   0000000     000
     */
    if (options.ignoreArgs != null) {
        options.ignoreArgs;
    } else {
        options.ignoreArgs = 2;
    }
    if (options.argv) {
        argv = options.argv;
    } else {
        argv = process.argv.slice(options.ignoreArgs);
    }
    expandedArgs = expand(argv);
    addParam = function(arg) {
        if (paramList) {
            return result[param].push(arg);
        } else {
            return result[param] = arg;
        }
    };
    addIgnored = function(arg) {
        if (!result['__ignored']) {
            result['__ignored'] = [];
        }
        return result['__ignored'].push(arg);
    };
    addParamOrIgnore = function(arg) {
        if (param) {
            return addParam(arg);
        } else {
            return addIgnored(arg);
        }
    };
    while (arg = expandedArgs.shift()) {
        if (arg.substr(0, 2) === '--') {
            arg = arg.substr(2);
        } else if (arg[0] === '-') {
            if (!short[arg.substr(1)]) {
                addIgnored(arg);
                continue;
            }
            arg = short[arg.substr(1)];
        } else {
            addParamOrIgnore(arg);
            continue;
        }
        if (arg === 'help') {
            if (options.returnLog) {
                return helpText;
            }
            console.log(helpText);
            if (options.dontExit) {
                return;
            }
            process.exit();
        } else if (arg === 'version' && (version != null)) {
            if (options.returnLog) {
                return version;
            }
            console.log(version);
            if (options.dontExit) {
                return;
            }
            process.exit();
        }
        if (result[arg] === false || result[arg] === true) {
            result[arg] = !result[arg];
        } else if (!isNaN(parseFloat(result[arg]))) {
            result[arg] = parseFloat(expandedArgs.shift());
        } else if (indexOf.call(values(short), arg) >= 0) {
            result[arg] = expandedArgs.shift();
        } else {
            addParamOrIgnore(arg);
        }
    }
    return result;
};

module.exports = parse;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2FyZy5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsb0VBQUE7SUFBQTs7QUFRQSxPQUFBLEdBQVcsT0FBQSxDQUFRLGdCQUFSOztBQUNYLE1BQUEsR0FBVyxPQUFBLENBQVEsZUFBUjs7QUFDWCxJQUFBLEdBQVcsT0FBQSxDQUFRLGFBQVI7O0FBQ1gsTUFBQSxHQUFXLE9BQUEsQ0FBUSxlQUFSOztBQUNYLFFBQUEsR0FBVyxPQUFBLENBQVEsaUJBQVI7O0FBQ1gsS0FBQSxHQUFXLE9BQUEsQ0FBUSxjQUFSOzs7QUFFWDs7Ozs7Ozs7QUFRQSxNQUFBLEdBQVMsU0FBQyxDQUFEO0FBQ0wsUUFBQTtBQUFBLFNBQUEsbUNBQUE7O1FBQ0ksSUFBRyxLQUFBLEdBQVEsYUFBYSxDQUFDLElBQWQsQ0FBbUIsQ0FBbkIsQ0FBWDtZQUNJLENBQUEsR0FBSSxLQUFNLENBQUEsQ0FBQSxDQUFFLENBQUMsS0FBVCxDQUFlLEVBQWYsQ0FBa0IsQ0FBQyxHQUFuQixDQUF1QixTQUFDLENBQUQ7dUJBQU8sR0FBQSxHQUFJO1lBQVgsQ0FBdkI7WUFDSixDQUFDLENBQUMsT0FBRixDQUFVLENBQUMsQ0FBQyxPQUFGLENBQVUsS0FBSyxDQUFDLEtBQWhCLENBQVYsRUFBa0MsQ0FBbEM7WUFDQSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQVQsQ0FBZSxDQUFmLEVBQWtCLENBQWxCO0FBQ0EsbUJBQU8sTUFBQSxDQUFPLENBQVAsRUFKWDs7QUFESjtXQU1BO0FBUEs7OztBQVNUOzs7Ozs7OztBQVFBLEtBQUEsR0FBUSxTQUFDLEdBQUQ7QUFDSixRQUFBO0lBQUEsQ0FBQSxHQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBUixHQUFjLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQS9CLEdBQXFDLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDbEQsQ0FBQSxJQUFLLEdBQUcsQ0FBQyxJQUFKLENBQUEsQ0FBVSxDQUFDLEtBQVgsQ0FBaUIsSUFBakIsQ0FBc0IsQ0FBQyxJQUF2QixDQUE0QixZQUE1QixDQUF5QyxDQUFDO1dBQUcsT0FBQSxDQUNsRCxHQURrRCxDQUM5QyxDQUQ4QztBQUY5Qzs7O0FBS1I7Ozs7Ozs7O0FBY0EsS0FBQSxHQUFRLFNBQUMsTUFBRCxFQUFTLE9BQVQ7QUFFSixRQUFBOztRQUZhLFVBQVE7O0lBRXJCLElBQUcsUUFBQSxDQUFTLE1BQVQsQ0FBSDtRQUNJLElBQUEsR0FBUyxPQUFBLENBQVEsTUFBUjtRQUNULE1BQUEsR0FBUyxJQUFJLENBQUMsS0FBTCxDQUFXLE1BQVgsRUFGYjtLQUFBLE1BQUE7UUFJSSxNQUFBLEdBQVMsS0FBQSxDQUFNLE1BQU4sRUFKYjs7SUFNQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFFBQVI7SUFFVCxJQUFBLEdBQVMsTUFBTSxDQUFDLElBQVAsQ0FBWSxNQUFaLENBQW9CLENBQUEsQ0FBQTtJQUM3QixNQUFBLEdBQVM7SUFDVCxJQUFBLEdBQVM7SUFDVCxLQUFBLEdBQVM7SUFDVCxLQUFBLEdBQVM7SUFDVCxTQUFBLEdBQVk7QUFFWjtBQUFBLFNBQUEsUUFBQTs7UUFFSSxJQUFHLENBQUEsSUFBSyxDQUFDLENBQUMsT0FBRixDQUFVLEdBQVYsQ0FBUjtZQUNHLE9BQUEsQ0FBQyxLQUFELENBQU8sb0JBQUEsR0FDYyw0QkFBNEIsQ0FBQyxJQUQzQyxHQUNnRCxnQkFEaEQsR0FFUSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BRnRCO1lBSUMsT0FBTyxDQUFDLElBQVIsQ0FBYSxDQUFiLEVBTEo7O1FBT0EsSUFBRyxjQUFIO1lBQWdCLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxDQUFFLENBQUEsR0FBQSxFQUE5Qjs7UUFFQSxHQUFBLEdBQU0sZ0JBQUEsSUFBWSxDQUFFLENBQUEsR0FBQSxDQUFkLElBQXNCLENBQUUsQ0FBQSxDQUFBO1FBRTlCLElBQUcsS0FBSyxDQUFDLE9BQU4sQ0FBYyxDQUFkLENBQUg7WUFDSSxJQUFHLGFBQU8sQ0FBUCxFQUFBLEdBQUEsTUFBSDtnQkFDSSxLQUFBLEdBQVEsRUFEWjthQUFBLE1BRUssSUFBRyxhQUFRLENBQVIsRUFBQSxJQUFBLE1BQUg7Z0JBQ0QsS0FBQSxHQUFRO2dCQUNSLFNBQUEsR0FBWTtnQkFDWixNQUFPLENBQUEsS0FBQSxDQUFQLEdBQWdCLEdBSGY7YUFBQSxNQUFBO2dCQUtELEtBQU0sQ0FBQSxHQUFBLENBQU4sR0FBYSxFQUxaO2FBSFQ7U0FBQSxNQUFBO1lBVUksSUFBRyxhQUFPLE1BQU0sQ0FBQyxJQUFQLENBQVksQ0FBWixDQUFQLEVBQUEsR0FBQSxNQUFIO2dCQUNJLEtBQUEsR0FBUSxFQURaO2FBQUEsTUFFSyxJQUFHLGFBQVEsTUFBTSxDQUFDLElBQVAsQ0FBWSxDQUFaLENBQVIsRUFBQSxJQUFBLE1BQUg7Z0JBQ0QsS0FBQSxHQUFRO2dCQUNSLFNBQUEsR0FBWTtnQkFDWixNQUFPLENBQUEsS0FBQSxDQUFQLEdBQWdCLEdBSGY7YUFBQSxNQUFBO2dCQUtELEtBQU0sQ0FBQSxHQUFBLENBQU4sR0FBYTtnQkFDYixJQUFLLENBQUEsR0FBQSxDQUFMLEdBQVksQ0FBRSxDQUFBLEdBQUEsRUFOYjthQVpUOztBQWJKOztBQWlDQTs7Ozs7OztJQVFBLFdBQUEsR0FBYztJQUVkLFlBQUEsR0FBZTtJQUNmLGFBQUEsR0FBZ0I7QUFDaEIsU0FBQSxZQUFBOztRQUNJLElBQUcsaUJBQUg7WUFDSSxZQUFBLEdBQWdCLElBQUksQ0FBQyxHQUFMLENBQVMsWUFBVCxFQUF1QixHQUFHLENBQUMsTUFBSixHQUFXLEdBQUcsQ0FBQyxNQUF0QztZQUNoQixhQUFBLEdBQWdCLElBQUksQ0FBQyxHQUFMLENBQVMsYUFBVCxFQUF3QixNQUFNLENBQUMsS0FBUCxDQUFhLElBQUssQ0FBQSxHQUFBLENBQWxCLENBQXVCLENBQUMsTUFBaEQsRUFGcEI7O0FBREo7QUFLQSxTQUFBLFlBQUE7O1FBQ0ksSUFBRyxpQkFBSDtZQUNJLEVBQUE7QUFBSyx3QkFBTyxNQUFPLENBQUEsR0FBQSxDQUFkO0FBQUEseUJBQ0ksS0FESjsrQkFDZSxHQUFHLENBQUMsR0FBRyxDQUFDO0FBRHZCLHlCQUVJLElBRko7K0JBRWUsR0FBRyxDQUFDLEtBQUssQ0FBQztBQUZ6QjsrQkFHSSxNQUFPLENBQUEsR0FBQTtBQUhYOztZQUlMLFdBQUEsSUFBZTtZQUNmLFdBQUEsSUFBZSxNQUFBLEdBQU8sR0FBRyxDQUFDLElBQVgsR0FBa0IsR0FBbEIsR0FBd0IsTUFBTSxDQUFDLElBQS9CLEdBQXNDO1lBQ3JELFdBQUEsSUFBZSxDQUFBLE1BQUEsR0FBTSxDQUFDLE1BQUEsQ0FBTyxFQUFQLEVBQVcsSUFBSSxDQUFDLEdBQUwsQ0FBUyxDQUFULEVBQVcsWUFBQSxHQUFhLEdBQUcsQ0FBQyxNQUFqQixHQUF3QixHQUFHLENBQUMsTUFBdkMsQ0FBWCxDQUFELENBQU4sR0FBaUUsR0FBakUsR0FBb0UsSUFBSyxDQUFBLEdBQUEsQ0FBekUsQ0FBK0UsQ0FBQyxJQUFJLENBQUM7WUFDcEcsSUFBNkcsVUFBN0c7Z0JBQUEsV0FBQSxJQUFlLENBQUEsTUFBQSxHQUFNLENBQUMsTUFBQSxDQUFPLEVBQVAsRUFBVyxJQUFJLENBQUMsR0FBTCxDQUFTLENBQVQsRUFBVyxhQUFBLEdBQWMsTUFBTSxDQUFDLEtBQVAsQ0FBYSxJQUFLLENBQUEsR0FBQSxDQUFsQixDQUF1QixDQUFDLE1BQWpELENBQVgsQ0FBRCxDQUFOLEdBQTJFLEdBQTNFLEdBQThFLEVBQTlFLENBQWtGLENBQUMsUUFBbEc7YUFSSjs7QUFESjs7QUFXQTs7Ozs7OztJQVFBLFFBQUEsR0FBWSxJQUFBLEdBQUssUUFBUSxDQUFDLElBQWQsR0FBbUIsSUFBbkIsR0FBdUIsSUFBSSxDQUFDLElBQTVCLEdBQWlDO0lBQzdDLElBQStELENBQUEsR0FBSSxJQUFBLENBQUssS0FBTCxDQUFuRTtRQUFBLFFBQUEsSUFBWSxFQUFBLEdBQUcsR0FBRyxDQUFDLElBQVAsR0FBYyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQTdCLEdBQW9DLEdBQUcsQ0FBQyxJQUF4QyxHQUE2QyxJQUF6RDs7SUFDQSxRQUFBLElBQVksRUFBQSxHQUFHLEdBQUcsQ0FBQyxJQUFQLEdBQWMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUF6QixHQUFpQyxDQUFDLFNBQUEsSUFBZSxRQUFRLENBQUMsSUFBeEIsSUFBa0MsR0FBRyxDQUFDLElBQXZDO0lBQzdDLFFBQUEsSUFBWTtJQUNaLCtDQUF3QixDQUFBLEdBQUEsVUFBeEI7UUFDSSxRQUFBLElBQVksQ0FBQSxJQUFBLEdBQUksQ0FBQyxNQUFBLENBQU8sVUFBQSxHQUFXLEtBQWxCLEVBQXlCLFlBQUEsR0FBYSxDQUF0QyxDQUFELENBQUosR0FBNkMsR0FBN0MsR0FBZ0QsTUFBTyxDQUFBLElBQUEsQ0FBTSxDQUFBLEtBQUEsQ0FBTyxDQUFBLEdBQUEsQ0FBSSxDQUFDLElBQXpFLENBQStFLENBQUMsTUFBTSxDQUFDO1FBQ25HLElBQTZJLGtDQUFBLElBQThCLENBQUksU0FBL0s7WUFBQSxRQUFBLElBQVksQ0FBQSxJQUFBLEdBQUksQ0FBQyxNQUFBLENBQU8sRUFBUCxFQUFXLElBQUksQ0FBQyxHQUFMLENBQVMsQ0FBVCxFQUFXLGFBQUEsR0FBYyxNQUFNLENBQUMsS0FBUCxDQUFhLE1BQU8sQ0FBQSxJQUFBLENBQU0sQ0FBQSxLQUFBLENBQU8sQ0FBQSxHQUFBLENBQWpDLENBQXNDLENBQUMsTUFBaEUsQ0FBWCxDQUFELENBQUosR0FBd0YsR0FBeEYsR0FBMkYsTUFBTyxDQUFBLElBQUEsQ0FBTSxDQUFBLEtBQUEsQ0FBTyxDQUFBLEdBQUEsQ0FBL0csQ0FBcUgsQ0FBQyxRQUFsSTs7UUFDQSxRQUFBLElBQVksS0FIaEI7O0lBS0EsSUFBRyxXQUFXLENBQUMsTUFBZjtRQUNJLFFBQUEsSUFBWSxjQUFjLENBQUM7UUFDM0IsUUFBQSxJQUFZO1FBQ1osUUFBQSxJQUFZLE9BSGhCOzs7UUFLQSxLQUFNLENBQUEsR0FBQTs7UUFBTixLQUFNLENBQUEsR0FBQSxJQUFROztJQUVkLElBQUcsc0JBQUg7UUFDSSxPQUFBLEdBQVUsTUFBTSxDQUFDO1FBQ2pCLE9BQU8sTUFBTSxDQUFDOztZQUNkLEtBQU0sQ0FBQSxHQUFBOztZQUFOLEtBQU0sQ0FBQSxHQUFBLElBQVE7U0FIbEI7O0lBS0EsTUFBQSxHQUFTLE9BQUEsQ0FBUSxRQUFSO0lBRVQsT0FBTyxNQUFPLENBQUEsSUFBQTtJQUNkLElBQUcsQ0FBSSxPQUFBLENBQVEsTUFBUixDQUFQO1FBQ0ksUUFBQSxJQUFZLElBQUksQ0FBQyxTQUFMLENBQWUsTUFBZixFQUNSO1lBQUEsUUFBQSxFQUFVLEVBQVY7WUFDQSxNQUFBLEVBQ0k7Z0JBQUEsR0FBQSxFQUFTLE1BQU0sQ0FBQyxJQUFoQjtnQkFDQSxNQUFBLEVBQVMsTUFBTSxDQUFDLEtBRGhCO2FBRko7U0FEUTtRQUtaLFFBQUEsSUFBWSxLQU5oQjs7O0FBUUE7Ozs7Ozs7O1FBUUEsT0FBTyxDQUFDOztRQUFSLE9BQU8sQ0FBQyxhQUFjOztJQUV0QixJQUFHLE9BQU8sQ0FBQyxJQUFYO1FBQ0ksSUFBQSxHQUFPLE9BQU8sQ0FBQyxLQURuQjtLQUFBLE1BQUE7UUFHSSxJQUFBLEdBQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFiLENBQW1CLE9BQU8sQ0FBQyxVQUEzQixFQUhYOztJQUtBLFlBQUEsR0FBZSxNQUFBLENBQU8sSUFBUDtJQUVmLFFBQUEsR0FBVyxTQUFDLEdBQUQ7UUFDUCxJQUFHLFNBQUg7bUJBQ0ksTUFBTyxDQUFBLEtBQUEsQ0FBTSxDQUFDLElBQWQsQ0FBbUIsR0FBbkIsRUFESjtTQUFBLE1BQUE7bUJBR0ksTUFBTyxDQUFBLEtBQUEsQ0FBUCxHQUFnQixJQUhwQjs7SUFETztJQU1YLFVBQUEsR0FBYSxTQUFDLEdBQUQ7UUFDVCxJQUFHLENBQUksTUFBTyxDQUFBLFdBQUEsQ0FBZDtZQUFnQyxNQUFPLENBQUEsV0FBQSxDQUFQLEdBQXNCLEdBQXREOztlQUNBLE1BQU8sQ0FBQSxXQUFBLENBQVksQ0FBQyxJQUFwQixDQUF5QixHQUF6QjtJQUZTO0lBSWIsZ0JBQUEsR0FBbUIsU0FBQyxHQUFEO1FBQ2YsSUFBRyxLQUFIO21CQUNJLFFBQUEsQ0FBUyxHQUFULEVBREo7U0FBQSxNQUFBO21CQUdJLFVBQUEsQ0FBVyxHQUFYLEVBSEo7O0lBRGU7QUFNbkIsV0FBTSxHQUFBLEdBQU0sWUFBWSxDQUFDLEtBQWIsQ0FBQSxDQUFaO1FBRUksSUFBRyxHQUFHLENBQUMsTUFBSixDQUFXLENBQVgsRUFBYSxDQUFiLENBQUEsS0FBbUIsSUFBdEI7WUFDSSxHQUFBLEdBQU0sR0FBRyxDQUFDLE1BQUosQ0FBVyxDQUFYLEVBRFY7U0FBQSxNQUVLLElBQUcsR0FBSSxDQUFBLENBQUEsQ0FBSixLQUFVLEdBQWI7WUFDRCxJQUFHLENBQUksS0FBTSxDQUFBLEdBQUcsQ0FBQyxNQUFKLENBQVcsQ0FBWCxDQUFBLENBQWI7Z0JBQ0ksVUFBQSxDQUFXLEdBQVg7QUFDQSx5QkFGSjs7WUFHQSxHQUFBLEdBQU0sS0FBTSxDQUFBLEdBQUcsQ0FBQyxNQUFKLENBQVcsQ0FBWCxDQUFBLEVBSlg7U0FBQSxNQUFBO1lBTUQsZ0JBQUEsQ0FBaUIsR0FBakI7QUFDQSxxQkFQQzs7UUFTTCxJQUFHLEdBQUEsS0FBTyxNQUFWO1lBQ0ksSUFBRyxPQUFPLENBQUMsU0FBWDtBQUEwQix1QkFBTyxTQUFqQzs7WUFBeUMsT0FBQSxDQUN6QyxHQUR5QyxDQUNyQyxRQURxQztZQUV6QyxJQUFVLE9BQU8sQ0FBQyxRQUFsQjtBQUFBLHVCQUFBOztZQUNBLE9BQU8sQ0FBQyxJQUFSLENBQUEsRUFKSjtTQUFBLE1BS0ssSUFBRyxHQUFBLEtBQU8sU0FBUCxJQUFxQixpQkFBeEI7WUFDRCxJQUFHLE9BQU8sQ0FBQyxTQUFYO0FBQTBCLHVCQUFPLFFBQWpDOztZQUF3QyxPQUFBLENBQ3hDLEdBRHdDLENBQ3BDLE9BRG9DO1lBRXhDLElBQVUsT0FBTyxDQUFDLFFBQWxCO0FBQUEsdUJBQUE7O1lBQ0EsT0FBTyxDQUFDLElBQVIsQ0FBQSxFQUpDOztRQU1MLElBQUcsTUFBTyxDQUFBLEdBQUEsQ0FBUCxLQUFlLEtBQWYsSUFBd0IsTUFBTyxDQUFBLEdBQUEsQ0FBUCxLQUFlLElBQTFDO1lBQ0ksTUFBTyxDQUFBLEdBQUEsQ0FBUCxHQUFjLENBQUksTUFBTyxDQUFBLEdBQUEsRUFEN0I7U0FBQSxNQUVLLElBQUcsQ0FBSSxLQUFBLENBQU0sVUFBQSxDQUFXLE1BQU8sQ0FBQSxHQUFBLENBQWxCLENBQU4sQ0FBUDtZQUNELE1BQU8sQ0FBQSxHQUFBLENBQVAsR0FBYyxVQUFBLENBQVcsWUFBWSxDQUFDLEtBQWIsQ0FBQSxDQUFYLEVBRGI7U0FBQSxNQUVBLElBQUcsYUFBTyxNQUFBLENBQU8sS0FBUCxDQUFQLEVBQUEsR0FBQSxNQUFIO1lBQ0QsTUFBTyxDQUFBLEdBQUEsQ0FBUCxHQUFjLFlBQVksQ0FBQyxLQUFiLENBQUEsRUFEYjtTQUFBLE1BQUE7WUFHRCxnQkFBQSxDQUFpQixHQUFqQixFQUhDOztJQTVCVDtXQWdDQTtBQXZMSTs7QUF5TFIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgICAwMDAwMDAwIFxuMDAwICAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgXG4wMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICAwMDAgIDAwMDBcbjAwMCAgMDAwICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgXG4jIyNcblxuaXNFbXB0eSAgPSByZXF1aXJlICdsb2Rhc2guaXNlbXB0eSdcbnBhZEVuZCAgID0gcmVxdWlyZSAnbG9kYXNoLnBhZGVuZCdcbnNpemUgICAgID0gcmVxdWlyZSAnbG9kYXNoLnNpemUnXG52YWx1ZXMgICA9IHJlcXVpcmUgJ2xvZGFzaC52YWx1ZXMnXG5pc1N0cmluZyA9IHJlcXVpcmUgJ2xvZGFzaC5pc3N0cmluZydcbmNsb25lICAgID0gcmVxdWlyZSAnbG9kYXNoLmNsb25lJ1xuXG4jIyNcbjAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAwICAgICAwMDAwMCAgICAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDBcbjAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMFxuMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgXG4jIyNcblxuZXhwYW5kID0gKGwpIC0+XG4gICAgZm9yIGEgaW4gbCBcbiAgICAgICAgaWYgbWF0Y2ggPSAvXlxcLShcXHdcXHcrKSQvLmV4ZWMgYVxuICAgICAgICAgICAgYSA9IG1hdGNoWzFdLnNwbGl0KCcnKS5tYXAgKGkpIC0+ICctJytpXG4gICAgICAgICAgICBhLnVuc2hpZnQgbC5pbmRleE9mKG1hdGNoLmlucHV0KSwgMVxuICAgICAgICAgICAgbC5zcGxpY2UuYXBwbHkgbCwgYVxuICAgICAgICAgICAgcmV0dXJuIGV4cGFuZCBsXG4gICAgbFxuXG4jIyNcbjAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMCBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcbjAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAwMDAwICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDBcbjAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiMjI1xuXG5lcnJvciA9IChtc2cpIC0+XG4gICAgcyA9IFwiW1wiLmRpbS5yZWQgKyBcIkVSUk9SXCIuYm9sZC5kaW0ucmVkICsgXCJdIFwiLmRpbS5yZWQgXG4gICAgcyArPSBtc2cudHJpbSgpLnNwbGl0KCdcXG4nKS5qb2luKFwiXFxuICAgICAgICBcIikucmVkXG4gICAgbG9nIHNcblxuIyMjXG4wMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDBcbjAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgIFxuMDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgXG4wMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICBcbjAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMFxuIyMjXG5cbiMgb3B0aW9uczogXG4jICAgICBpZ25vcmVBcmdzOiAgbnVtYmVyIG9mIGxlYWRpbmcgcHJvY2Vzcy5hcmd2IGl0ZW1zIHRvIGlnbm9yZSAoZGVmYXVsdD0yKVxuIyAgICAgYXJndjogICAgICAgIGxpc3Qgb2Ygc3RyaW5nIGFyZ3VtZW50cyB0byB1c2UgaW5zdGVhZCBvZiBwcm9jZXNzLmFyZ3ZcbiMgICAgIGRvbnRFeGl0OiAgICBkb24ndCBleGl0IHByb2Nlc3Mgb24gLVYvLS12ZXJzaW9uIG9yIC1oLy0taGVscCAgKHJldHVybnMgdW5kZWZpbmVkIGluc3RlYWQpXG4jICAgICByZXR1cm5Mb2c6ICAgaGVscC92ZXJzaW9uIG91dHB1dCBpcyByZXR1cm5lZCBpbnN0ZWFkIG9mIGxvZ2dlZCAoaW1wbGllcyBkb250RXhpdClcblxucGFyc2UgPSAoY29uZmlnLCBvcHRpb25zPXt9KSAtPlxuICAgIFxuICAgIGlmIGlzU3RyaW5nIGNvbmZpZ1xuICAgICAgICBub29uICAgPSByZXF1aXJlICdub29uJ1xuICAgICAgICBjb25maWcgPSBub29uLnBhcnNlIGNvbmZpZ1xuICAgIGVsc2VcbiAgICAgICAgY29uZmlnID0gY2xvbmUgY29uZmlnXG4gICAgICAgIFxuICAgIGNvbG9ycyA9IHJlcXVpcmUgJ2NvbG9ycydcblxuICAgIG5hbWUgICA9IE9iamVjdC5rZXlzKGNvbmZpZylbMF0gIyB0aGUgYXBwbGljYXRpb24vc2NyaXB0IG5hbWVcbiAgICByZXN1bHQgPSB7fSAjIHRoZSBvYmplY3QgY3JlYXRlZCBmcm9tIHRoZSBwcm92aWRlZCBhcmd1bWVudHMgYW5kIHRoZSBjb25maWd1cmF0aW9uXG4gICAgaGVscCAgID0ge30gIyBtYXBzIHNob3J0Y3V0IGtleXMgdG8gaGVscCB0ZXh0c1xuICAgIHNob3J0ICA9IHt9ICMgbWFwcyBzaG9ydGN1dCBrZXlzIHRvIGxvbmcga2V5IG5hbWVzXG4gICAgcGFyYW0gID0gJycgIyBuYW1lIG9mIG5vbi1vcHRpb24gcGFyYW1ldGVyc1xuICAgIHBhcmFtTGlzdCA9IGZhbHNlXG4gICAgXG4gICAgZm9yIGssdiBvZiBjb25maWdbbmFtZV1cbiAgICAgICAgXG4gICAgICAgIGlmIDAgPD0gay5pbmRleE9mICcgJ1xuICAgICAgICAgICAgZXJyb3IgXCJcIlwiXG4gICAgICAgICAgICB3cm9uZyBrYXJnIHNldHVwOiAje1wia2V5cyBjYW4ndCBjb250YWluIHNwYWNlcyFcIi5ib2xkfVxuICAgICAgICAgICAgYnJva2VuIGtleTogI3trLmJvbGQueWVsbG93fVxuICAgICAgICAgICAgXCJcIlwiXG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQgMVxuICAgICAgICBcbiAgICAgICAgaWYgdlsnPSddPyB0aGVuIHJlc3VsdFtrXSA9IHZbJz0nXVxuICAgICAgICBcbiAgICAgICAgc2h0ID0gdlsnLSddPyBhbmQgdlsnLSddIG9yIGtbMF1cbiAgICAgICAgXG4gICAgICAgIGlmIEFycmF5LmlzQXJyYXkgdlxuICAgICAgICAgICAgaWYgJyonIGluIHZcbiAgICAgICAgICAgICAgICBwYXJhbSA9IGtcbiAgICAgICAgICAgIGVsc2UgaWYgJyoqJyBpbiB2XG4gICAgICAgICAgICAgICAgcGFyYW0gPSBrXG4gICAgICAgICAgICAgICAgcGFyYW1MaXN0ID0gdHJ1ZVxuICAgICAgICAgICAgICAgIHJlc3VsdFtwYXJhbV0gPSBbXVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHNob3J0W3NodF0gPSBrXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGlmICcqJyBpbiBPYmplY3Qua2V5cyB2XG4gICAgICAgICAgICAgICAgcGFyYW0gPSBrXG4gICAgICAgICAgICBlbHNlIGlmICcqKicgaW4gT2JqZWN0LmtleXMgdlxuICAgICAgICAgICAgICAgIHBhcmFtID0ga1xuICAgICAgICAgICAgICAgIHBhcmFtTGlzdCA9IHRydWVcbiAgICAgICAgICAgICAgICByZXN1bHRbcGFyYW1dID0gW11cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzaG9ydFtzaHRdID0ga1xuICAgICAgICAgICAgICAgIGhlbHBbc2h0XSA9IHZbJz8nXVxuXG4gICAgIyMjXG4gICAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDBcbiAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgIFxuICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDAgIDAwMDAwMDAgXG4gICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgICAgICAwMDBcbiAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwIFxuICAgICMjI1xuICAgIFxuICAgIG9wdGlvbnNUZXh0ID0gXCJcIlxuICAgIFxuICAgIG1heEFyZ0xlbmd0aCA9IDBcbiAgICBtYXhIZWxwTGVuZ3RoID0gMFxuICAgIGZvciBzaHQsbG5nIG9mIHNob3J0XG4gICAgICAgIGlmIGhlbHBbc2h0XT9cbiAgICAgICAgICAgIG1heEFyZ0xlbmd0aCAgPSBNYXRoLm1heChtYXhBcmdMZW5ndGgsIHNodC5sZW5ndGgrbG5nLmxlbmd0aClcbiAgICAgICAgICAgIG1heEhlbHBMZW5ndGggPSBNYXRoLm1heChtYXhIZWxwTGVuZ3RoLCBjb2xvcnMuc3RyaXAoaGVscFtzaHRdKS5sZW5ndGgpXG4gICAgICAgICAgICBcbiAgICBmb3Igc2h0LGxuZyBvZiBzaG9ydFxuICAgICAgICBpZiBoZWxwW3NodF0/XG4gICAgICAgICAgICBkZiA9IHN3aXRjaCByZXN1bHRbbG5nXVxuICAgICAgICAgICAgICAgIHdoZW4gZmFsc2UgdGhlbiAn4pyYJy5yZWQuZGltXG4gICAgICAgICAgICAgICAgd2hlbiB0cnVlICB0aGVuICfinJQnLmdyZWVuLmJvbGRcbiAgICAgICAgICAgICAgICBlbHNlIHJlc3VsdFtsbmddXG4gICAgICAgICAgICBvcHRpb25zVGV4dCArPSAnXFxuJ1xuICAgICAgICAgICAgb3B0aW9uc1RleHQgKz0gXCIgICAgI3snLScuZ3JheX0je3NodH0jeycsIC0tJy5ncmF5fSN7bG5nfVwiXG4gICAgICAgICAgICBvcHRpb25zVGV4dCArPSBcIiAgICAje3BhZEVuZCAnJywgTWF0aC5tYXgoMCxtYXhBcmdMZW5ndGgtc2h0Lmxlbmd0aC1sbmcubGVuZ3RoKX0gI3toZWxwW3NodF19XCIuZ3JheS5ib2xkXG4gICAgICAgICAgICBvcHRpb25zVGV4dCArPSBcIiAgICAje3BhZEVuZCAnJywgTWF0aC5tYXgoMCxtYXhIZWxwTGVuZ3RoLWNvbG9ycy5zdHJpcChoZWxwW3NodF0pLmxlbmd0aCl9ICN7ZGZ9XCIubWFnZW50YSBpZiBkZj9cblxuICAgICMjI1xuICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMDAwMDAwIFxuICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMFxuICAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAwIFxuICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgIFxuICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMCAgICAgIFxuICAgICMjI1xuICAgIFxuICAgIGhlbHBUZXh0ICA9IFwiXFxuI3sndXNhZ2U6Jy5ncmF5fSAgI3tuYW1lLmJvbGR9IFwiXG4gICAgaGVscFRleHQgKz0gXCIjeydbJy5ncmF5fSN7J29wdGlvbnMnLmJvbGQuZ3JheX0jeyddJy5ncmF5fSBcIiBpZiAxIDwgc2l6ZSBzaG9ydFxuICAgIGhlbHBUZXh0ICs9IFwiI3snWycuZ3JheX0je3BhcmFtLmJvbGQueWVsbG93fSN7cGFyYW1MaXN0IGFuZCAoJyAuLi4gXScuZ3JheSkgb3IgKCddJy5ncmF5KX1cIlxuICAgIGhlbHBUZXh0ICs9ICdcXG4nXG4gICAgaWYgY29uZmlnW25hbWVdW3BhcmFtXT9bJz8nXVxuICAgICAgICBoZWxwVGV4dCArPSBcIlxcbiN7cGFkRW5kICcgICAgICAgICcrcGFyYW0sIG1heEFyZ0xlbmd0aCs5fSAje2NvbmZpZ1tuYW1lXVtwYXJhbV1bJz8nXS5ncmF5fVwiLnllbGxvdy5ib2xkXG4gICAgICAgIGhlbHBUZXh0ICs9IFwiICAje3BhZEVuZCAnJywgTWF0aC5tYXgoMCxtYXhIZWxwTGVuZ3RoLWNvbG9ycy5zdHJpcChjb25maWdbbmFtZV1bcGFyYW1dWyc/J10pLmxlbmd0aCl9ICN7Y29uZmlnW25hbWVdW3BhcmFtXVsnPSddfVwiLm1hZ2VudGEgaWYgY29uZmlnW25hbWVdW3BhcmFtXVsnPSddPyBhbmQgbm90IHBhcmFtTGlzdFxuICAgICAgICBoZWxwVGV4dCArPSAnXFxuJ1xuICAgICAgICAgICAgXG4gICAgaWYgb3B0aW9uc1RleHQubGVuZ3RoXG4gICAgICAgIGhlbHBUZXh0ICs9IFwiXFxub3B0aW9uczpcXG5cIi5ncmF5XG4gICAgICAgIGhlbHBUZXh0ICs9IG9wdGlvbnNUZXh0XG4gICAgICAgIGhlbHBUZXh0ICs9ICdcXG5cXG4nXG4gICAgXG4gICAgc2hvcnRbJ2gnXSA/PSAnaGVscCdcbiAgICBcbiAgICBpZiBjb25maWcudmVyc2lvbj9cbiAgICAgICAgdmVyc2lvbiA9IGNvbmZpZy52ZXJzaW9uXG4gICAgICAgIGRlbGV0ZSBjb25maWcudmVyc2lvblxuICAgICAgICBzaG9ydFsnViddID89ICd2ZXJzaW9uJ1xuICAgICAgICBcbiAgICBjb2xvcnMgPSByZXF1aXJlICdjb2xvcnMnXG4gICAgXG4gICAgZGVsZXRlIGNvbmZpZ1tuYW1lXVxuICAgIGlmIG5vdCBpc0VtcHR5IGNvbmZpZ1xuICAgICAgICBoZWxwVGV4dCArPSBub29uLnN0cmluZ2lmeSBjb25maWcsIFxuICAgICAgICAgICAgbWF4YWxpZ246IDE2XG4gICAgICAgICAgICBjb2xvcnM6IFxuICAgICAgICAgICAgICAgIGtleTogICAgIGNvbG9ycy5ncmF5XG4gICAgICAgICAgICAgICAgc3RyaW5nOiAgY29sb3JzLndoaXRlXG4gICAgICAgIGhlbHBUZXh0ICs9ICdcXG4nXG4gICAgICAgIFxuICAgICMjI1xuICAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwMFxuICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgIFxuICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgIFxuICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgIFxuICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgIFxuICAgICMjI1xuXG4gICAgb3B0aW9ucy5pZ25vcmVBcmdzID89IDJcbiAgICBcbiAgICBpZiBvcHRpb25zLmFyZ3ZcbiAgICAgICAgYXJndiA9IG9wdGlvbnMuYXJndlxuICAgIGVsc2VcbiAgICAgICAgYXJndiA9IHByb2Nlc3MuYXJndi5zbGljZSBvcHRpb25zLmlnbm9yZUFyZ3NcbiAgICAgICAgXG4gICAgZXhwYW5kZWRBcmdzID0gZXhwYW5kIGFyZ3ZcblxuICAgIGFkZFBhcmFtID0gKGFyZykgLT5cbiAgICAgICAgaWYgcGFyYW1MaXN0XG4gICAgICAgICAgICByZXN1bHRbcGFyYW1dLnB1c2ggYXJnXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlc3VsdFtwYXJhbV0gPSBhcmdcbiAgICAgICAgICAgIFxuICAgIGFkZElnbm9yZWQgPSAoYXJnKSAtPlxuICAgICAgICBpZiBub3QgcmVzdWx0WydfX2lnbm9yZWQnXSB0aGVuIHJlc3VsdFsnX19pZ25vcmVkJ10gPSBbXVxuICAgICAgICByZXN1bHRbJ19faWdub3JlZCddLnB1c2ggYXJnXG4gICAgICAgIFxuICAgIGFkZFBhcmFtT3JJZ25vcmUgPSAoYXJnKSAtPlxuICAgICAgICBpZiBwYXJhbVxuICAgICAgICAgICAgYWRkUGFyYW0gYXJnXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGFkZElnbm9yZWQgYXJnXG4gICAgXG4gICAgd2hpbGUgYXJnID0gZXhwYW5kZWRBcmdzLnNoaWZ0KClcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBhcmcuc3Vic3RyKDAsMikgPT0gJy0tJ1xuICAgICAgICAgICAgYXJnID0gYXJnLnN1YnN0ciAyXG4gICAgICAgIGVsc2UgaWYgYXJnWzBdID09ICctJ1xuICAgICAgICAgICAgaWYgbm90IHNob3J0W2FyZy5zdWJzdHIgMV1cbiAgICAgICAgICAgICAgICBhZGRJZ25vcmVkIGFyZ1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICBhcmcgPSBzaG9ydFthcmcuc3Vic3RyIDFdXG4gICAgICAgIGVsc2UgXG4gICAgICAgICAgICBhZGRQYXJhbU9ySWdub3JlIGFyZ1xuICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBhcmcgPT0gJ2hlbHAnXG4gICAgICAgICAgICBpZiBvcHRpb25zLnJldHVybkxvZyB0aGVuIHJldHVybiBoZWxwVGV4dFxuICAgICAgICAgICAgbG9nIGhlbHBUZXh0XG4gICAgICAgICAgICByZXR1cm4gaWYgb3B0aW9ucy5kb250RXhpdFxuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KClcbiAgICAgICAgZWxzZSBpZiBhcmcgPT0gJ3ZlcnNpb24nIGFuZCB2ZXJzaW9uP1xuICAgICAgICAgICAgaWYgb3B0aW9ucy5yZXR1cm5Mb2cgdGhlbiByZXR1cm4gdmVyc2lvblxuICAgICAgICAgICAgbG9nIHZlcnNpb25cbiAgICAgICAgICAgIHJldHVybiBpZiBvcHRpb25zLmRvbnRFeGl0XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoKVxuICAgICAgICAgICAgXG4gICAgICAgIGlmIHJlc3VsdFthcmddID09IGZhbHNlIG9yIHJlc3VsdFthcmddID09IHRydWVcbiAgICAgICAgICAgIHJlc3VsdFthcmddID0gbm90IHJlc3VsdFthcmddXG4gICAgICAgIGVsc2UgaWYgbm90IGlzTmFOIHBhcnNlRmxvYXQgcmVzdWx0W2FyZ11cbiAgICAgICAgICAgIHJlc3VsdFthcmddID0gcGFyc2VGbG9hdCBleHBhbmRlZEFyZ3Muc2hpZnQoKVxuICAgICAgICBlbHNlIGlmIGFyZyBpbiB2YWx1ZXMgc2hvcnRcbiAgICAgICAgICAgIHJlc3VsdFthcmddID0gZXhwYW5kZWRBcmdzLnNoaWZ0KClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgYWRkUGFyYW1Pcklnbm9yZSBhcmdcbiAgICByZXN1bHRcblxubW9kdWxlLmV4cG9ydHMgPSBwYXJzZVxuIl19
//# sourceURL=../coffee/karg.coffee